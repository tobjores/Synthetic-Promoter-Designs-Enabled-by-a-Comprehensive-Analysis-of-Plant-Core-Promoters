%\tikzset{external/export next = false}

\begin{tikzpicture}

	\begin{pgfinterruptboundingbox}

			%%% NAC positions
			\coordinate (NACscanPos) at (0, 0);
			
			\setlength{\templength}{\twocolumnwidth - \plotylabelwidth}
			
			\draw[very thick, gray] (NACscanPos) ++(\plotylabelwidth, -.5\columnsep) coordinate (TF pos1) -- ++(\templength, 0) coordinate (TF pos4end);
			
			\draw[line width = .1cm, 35S enhancer] ($(TF pos1) + (.78\templength, 0)$) -- ++(.05\templength, 0) node[anchor = south, pos = .5, node font = \figsmall] {TATA};
			
			\draw[-{Stealth[round]}] ($(TF pos1) + (.97\templength, 0)$) coordinate (TSS) |- ++(.2, .15);
			\draw[gray] (TSS) -- ++(0, -.15) node[anchor = east, rotate = 90, node font = \figsmall] {\pgfmathprintnumber[print sign = true, precision = 0]{1}};
			
			\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_NAC_leaf_boxplot.tsv}\as\position{
				\fill[SlateBlue4] ($(TF pos1) + (\position/170*\templength, -.025)$) -- ++(-.075, -.15) -- ++(.15, 0) node[pos = .5, anchor = east, rotate = 90, node font = \figsmall] (pos\position) {\pgfmathparse{\position - 166}\pgfmathprintnumber[print sign = true, precision = 0]{\pgfmathresult}} -- cycle;
			}
			
			\node[anchor = east, SlateBlue4, align = right, node font = \figsmall, xshift = \plotylabelwidth] at (NACscanPos |- pos10) {NAC\\[-.25\baselineskip]position};
	
			%%% NAC position scan (tobacco)
			\coordinate[yshift = -.5\columnsep] (NACscanLeaf) at (NACscanPos |- pos10.west);
			
			\leafsymbol[(.35, -.15)]{NACscanLeaf};
			
			\begin{axis}[%
				anchor = north west,
				at = {(NACscanLeaf)},
				xshift = \plotylabelwidth,
				width = \twocolumnwidth - \plotylabelwidth,
				xlabel = NAC binding site position  (rel. to TSS),
				ylabel = $\log_2$(rel. promoter strength),
				ylabel style = {xshift = -\baselineskip},
				xmin = 0,
				xmax = 170,
				xtick = {10, 30, ..., 150, 166},
				xticklabel = {$\pgfmathparse{\tick < 166 ? \tick - 166 : \tick -165}\pgfmathprintnumber[print sign]{\pgfmathresult}$},
				ymin = -3.2,
				ymax = 4,
				ytick = {-10, -9, ..., 10},
				zero line,
				x grids = false
			]
			
				% TATA-box
				\fill[35S enhancer, fill opacity = .1] (132.5, \ymin) rectangle (140.5, \ymax) node[pos = .5, opacity = 1, node font = \figsmall] {TATA};
			
				% boxplots
				\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_NAC_leaf_boxplot.tsv}\as\sample{
					\ifthenelse{\pgfplotstablerow<0}{}{
						\pgfmathparse{50 + (50 * \sample / 170)}
						\edef\colpct{\pgfmathresult}
						\pgfmathparse{int(\pgfplotstablerow + 1)}
						\edef\thisboxplot{
							\noexpand\boxplot[%
								boxplot/draw position = \sample,
								box color = leafCol,
								fill opacity = .5,
								fill = boxcol!\colpct!boxshade,
								boxplot/box extend = 4%
							]{rawData/enrichment_TFscan_NAC_leaf_boxplot.tsv}{\pgfmathresult};
							\noexpand\addplot [black, only marks, mark = solido] table [x expr = \sample, y = outlier.\pgfmathresult] {rawData/enrichment_TFscan_NAC_leaf_boxplot_outliers.tsv};
						}
						\thisboxplot
					}
				}
				
				% add sample size
				\samplesize[nodes near coords style = {anchor = west, rotate = 90}]{rawData/enrichment_TFscan_NAC_leaf_boxplot.tsv}{sample}{n}
					
			\end{axis}
			
			
			%%% NAC positions
			\coordinate (NACscanPos2) at (NACscanPos -| \textwidth - \twocolumnwidth, 0);
			
			\setlength{\templength}{\twocolumnwidth - \plotylabelwidth}
			
			\draw[very thick, gray] (NACscanPos2) ++(\plotylabelwidth, -.5\columnsep) coordinate (TF pos1) -- ++(\templength, 0) coordinate (TF pos4end);
			
			\draw[line width = .1cm, 35S enhancer] ($(TF pos1) + (.78\templength, 0)$) -- ++(.05\templength, 0) node[anchor = south, pos = .5, node font = \figsmall] {TATA};
			
			\draw[-{Stealth[round]}] ($(TF pos1) + (.97\templength, 0)$) coordinate (TSS) |- ++(.2, .15);
			\draw[gray] (TSS) -- ++(0, -.15) node[anchor = east, rotate = 90, node font = \figsmall] {\pgfmathprintnumber[print sign = true, precision = 0]{1}};
			
			\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_NAC_proto_boxplot.tsv}\as\position{
				\fill[SlateBlue4] ($(TF pos1) + (\position/170*\templength, -.025)$) -- ++(-.075, -.15) -- ++(.15, 0) node[pos = .5, anchor = east, rotate = 90, node font = \figsmall, alias = last pos] (pos\position) {\pgfmathparse{\position - 166}\pgfmathprintnumber[print sign = true, precision = 0]{\pgfmathresult}} -- cycle;
			}
			
			\node[anchor = east, SlateBlue4, align = right, node font = \figsmall, xshift = \plotylabelwidth] at (NACscanPos2 |- pos10) {NAC\\[-.25\baselineskip]position};
			
			
			%%% NAC position scan (protoplasts)
			\coordinate (NACscanProto) at (NACscanPos2 |- NACscanLeaf);
			
			\protosymbol[(.35, -.15)]{NACscanProto};
			
			\begin{axis}[%
				anchor = north west,
				at = {(NACscanProto)},
				xshift = \plotylabelwidth,
				width = \twocolumnwidth - \plotylabelwidth,
				xlabel = NAC binding site position (rel. to TSS),
				xlabel style = {name = plot xlabel},
				ylabel = $\log_2$(rel. promoter strength),
				ylabel style = {xshift = -\baselineskip},
				xmin = 0,
				xmax = 170,
				xtick = {10, 30, ..., 150, 166},
				xticklabel = {$\pgfmathparse{\tick < 166 ? \tick - 166 : \tick -165}\pgfmathprintnumber[print sign]{\pgfmathresult}$},
				ymin = -3.2,
				ymax = 4,
				ytick = {-10, -9, ..., 10},
				zero line,
				x grids = false
			]
			
				% TATA-box
				\fill[35S enhancer, fill opacity = .1] (132.5, \ymin) rectangle (140.5, \ymax) node[pos = .5, opacity = 1, node font = \figsmall] {TATA};
			
				% boxplots
				\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_NAC_proto_boxplot.tsv}\as\sample{
					\ifthenelse{\pgfplotstablerow<0}{}{
						\pgfmathparse{50 + (50 * \sample / 170)}
						\edef\colpct{\pgfmathresult}
						\pgfmathparse{int(\pgfplotstablerow + 1)}
						\edef\thisboxplot{
							\noexpand\boxplot[boxplot/draw position = \sample, box color = protoCol, fill opacity = .5, fill = boxcol!\colpct!boxshade, boxplot/box extend = 4]{rawData/enrichment_TFscan_NAC_proto_boxplot.tsv}{\pgfmathresult};
							\noexpand\addplot [black, only marks, mark = solido] table [x expr = \sample, y = outlier.\pgfmathresult] {rawData/enrichment_TFscan_NAC_proto_boxplot_outliers.tsv};
						}
						\thisboxplot
					}
				}
				
				% add sample size
				\samplesize[nodes near coords style = {anchor = west, rotate = 90}]{rawData/enrichment_TFscan_NAC_proto_boxplot.tsv}{sample}{n}
					
			\end{axis}
			
			
			%%% HSF positions
			\coordinate[yshift = -\columnsep] (HSFscanPos) at (NACscanPos |- plot xlabel.south);
			
			\setlength{\templength}{\twocolumnwidth - \plotylabelwidth}
			
			\draw[very thick, gray] (HSFscanPos) ++(\plotylabelwidth, -.5\columnsep) coordinate (TF pos1) -- ++(\templength, 0) coordinate (TF pos4end);
			
			\draw[line width = .1cm, 35S enhancer] ($(TF pos1) + (.78\templength, 0)$) -- ++(.05\templength, 0) node[anchor = south, pos = .5, node font = \figsmall] {TATA};
			
			\draw[-{Stealth[round]}] ($(TF pos1) + (.97\templength, 0)$) coordinate (TSS) |- ++(.2, .15);
			\draw[gray] (TSS) -- ++(0, -.15) node[anchor = east, rotate = 90, node font = \figsmall] {\pgfmathprintnumber[print sign = true, precision = 0]{1}};
			
			\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_HSF_leaf_boxplot.tsv}\as\position{
				\fill[SlateBlue4] ($(TF pos1) + (\position/170*\templength, -.025)$) -- ++(-.075, -.15) -- ++(.15, 0) node[pos = .5, anchor = east, rotate = 90, node font = \figsmall] (pos\position) {\pgfmathparse{\position - 166}\pgfmathprintnumber[print sign = true, precision = 0]{\pgfmathresult}} -- cycle;
			}
			
			\node[anchor = east, SlateBlue4, align = right, node font = \figsmall, xshift = \plotylabelwidth] at (HSFscanPos |- pos10) {HSF\\[-.25\baselineskip]position};
	
	
			%%% HSF position scan (tobacco)
			\coordinate[yshift = -.5\columnsep] (HSFscanLeaf) at (HSFscanPos |- pos10.west);
			
			\leafsymbol[(.35, -.15)]{HSFscanLeaf};
			
			\begin{axis}[%
				anchor = north west,
				at = {(HSFscanLeaf)},
				xshift = \plotylabelwidth,
				width = \twocolumnwidth - \plotylabelwidth,
				xlabel = HSF binding site position  (rel. to TSS),
				ylabel = $\log_2$(rel. promoter strength),
				ylabel style = {xshift = -\baselineskip},
				xmin = 0,
				xmax = 170,
				xtick = {10, 30, ..., 150, 166},
				xticklabel = {$\pgfmathparse{\tick < 166 ? \tick - 166 : \tick -165}\pgfmathprintnumber[print sign]{\pgfmathresult}$},
				ymin = -3.2,
				ymax = 4,
				ytick = {-10, -9, ..., 10},
				zero line,
				x grids = false
			]
			
				% TATA-box
				\fill[35S enhancer, fill opacity = .1] (132.5, \ymin) rectangle (140.5, \ymax) node[pos = .5, opacity = 1, node font = \figsmall] {TATA};
			
				% boxplots
				\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_HSF_leaf_boxplot.tsv}\as\sample{
					\ifthenelse{\pgfplotstablerow<0}{}{
						\pgfmathparse{50 + (50 * \sample / 170)}
						\edef\colpct{\pgfmathresult}
						\pgfmathparse{int(\pgfplotstablerow + 1)}
						\edef\thisboxplot{
							\noexpand\boxplot[%
								boxplot/draw position = \sample,
								box color = leafCol,
								fill opacity = .5,
								fill = boxcol!\colpct!boxshade,
								boxplot/box extend = 4%
							]{rawData/enrichment_TFscan_HSF_leaf_boxplot.tsv}{\pgfmathresult};
							\noexpand\addplot [black, only marks, mark = solido] table [x expr = \sample, y = outlier.\pgfmathresult] {rawData/enrichment_TFscan_HSF_leaf_boxplot_outliers.tsv};
						}
						\thisboxplot
					}
				}
				
				% add sample size
				\samplesize[nodes near coords style = {anchor = west, rotate = 90}]{rawData/enrichment_TFscan_HSF_leaf_boxplot.tsv}{sample}{n}
					
			\end{axis}
			
			
			%%% TCP positions
			\coordinate (TCPscanPos) at (HSFscanPos -| NACscanPos2);
			
			\setlength{\templength}{\twocolumnwidth - \plotylabelwidth}
			
			\draw[very thick, gray] (TCPscanPos) ++(\plotylabelwidth, -.5\columnsep) coordinate (TF pos1) -- ++(\templength, 0) coordinate (TF pos4end);
			
			\draw[line width = .1cm, 35S enhancer] ($(TF pos1) + (.78\templength, 0)$) -- ++(.05\templength, 0) node[anchor = south, pos = .5, node font = \figsmall] {TATA};
			
			\draw[-{Stealth[round]}] ($(TF pos1) + (.97\templength, 0)$) coordinate (TSS) |- ++(.2, .15);
			\draw[gray] (TSS) -- ++(0, -.15) node[anchor = east, rotate = 90, node font = \figsmall] {\pgfmathprintnumber[print sign = true, precision = 0]{1}};
			
			\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_TCP_proto_boxplot.tsv}\as\position{
				\fill[SlateBlue4] ($(TF pos1) + (\position/170*\templength, -.025)$) -- ++(-.075, -.15) -- ++(.15, 0) node[pos = .5, anchor = east, rotate = 90, node font = \figsmall, alias = last pos] (pos\position) {\pgfmathparse{\position - 166}\pgfmathprintnumber[print sign = true, precision = 0]{\pgfmathresult}} -- cycle;
			}
			
			\node[anchor = east, SlateBlue4, align = right, node font = \figsmall, xshift = \plotylabelwidth] at (TCPscanPos |- pos10) {TCP\\[-.25\baselineskip]position};
			
			
			%%% TCP position scan (protoplasts)
			\coordinate (TCPscanProto) at (TCPscanPos |- HSFscanLeaf);
			
			\protosymbol[(.35, -.15)]{TCPscanProto};
			
			\begin{axis}[%
				anchor = north west,
				at = {(TCPscanProto)},
				xshift = \plotylabelwidth,
				width = \twocolumnwidth - \plotylabelwidth,
				xlabel = TCP binding site position (rel. to TSS),
				xlabel style = {name = plot xlabel},
				ylabel = $\log_2$(rel. promoter strength),
				ylabel style = {xshift = -\baselineskip},
				xmin = 0,
				xmax = 170,
				xtick = {10, 30, ..., 150, 166},
				xticklabel = {$\pgfmathparse{\tick < 166 ? \tick - 166 : \tick -165}\pgfmathprintnumber[print sign]{\pgfmathresult}$},
				ymin = -3.2,
				ymax = 4,
				ytick = {-10, -9, ..., 10},
				zero line,
				x grids = false
			]
			
				% TATA-box
				\fill[35S enhancer, fill opacity = .1] (132.5, \ymin) rectangle (140.5, \ymax) node[pos = .5, opacity = 1, node font = \figsmall] {TATA};
			
				% boxplots
				\pgfplotstableforeachcolumnelement{sample}\of{rawData/enrichment_TFscan_TCP_proto_boxplot.tsv}\as\sample{
					\ifthenelse{\pgfplotstablerow<0}{}{
						\pgfmathparse{50 + (50 * \sample / 170)}
						\edef\colpct{\pgfmathresult}
						\pgfmathparse{int(\pgfplotstablerow + 1)}
						\edef\thisboxplot{
							\noexpand\boxplot[boxplot/draw position = \sample, box color = protoCol, fill opacity = .5, fill = boxcol!\colpct!boxshade, boxplot/box extend = 4]{rawData/enrichment_TFscan_TCP_proto_boxplot.tsv}{\pgfmathresult};
							\noexpand\addplot [black, only marks, mark = solido] table [x expr = \sample, y = outlier.\pgfmathresult] {rawData/enrichment_TFscan_TCP_proto_boxplot_outliers.tsv};
						}
						\thisboxplot
					}
				}
				
				% add sample size
				\samplesize[nodes near coords style = {anchor = west, rotate = 90}]{rawData/enrichment_TFscan_TCP_proto_boxplot.tsv}{sample}{n}
					
			\end{axis}
			
			
			%%% subfigure labels
			\subfiglabel[yshift = .5\columnsep]{NACscanPos}
			\subfiglabel[yshift = .5\columnsep]{NACscanPos2}
			\subfiglabel[yshift = .5\columnsep]{HSFscanPos}
			\subfiglabel[yshift = .5\columnsep]{TCPscanPos}
			
	\end{pgfinterruptboundingbox}
	
	% manually add the correct bounding box
	\path (NACscanPos) ++(.2pt, .5\columnsep) rectangle (\textwidth + .2pt, 0 |- plot xlabel.south);

\end{tikzpicture}